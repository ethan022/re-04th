"""
============================================================
01. 선형 회귀 기초 (Linear Regression Basics)
============================================================

이 파일에서 배울 내용:
1. 선형 회귀가 무엇인지
2. 왜 선형 회귀를 사용하는지
3. 직접 구현하는 방법
4. 라이브러리로 쉽게 사용하는 방법
5. 실전에서 어떻게 활용하는지

소요 시간: 약 30분
난이도: ★☆☆☆☆ (입문)
"""

# ============================================================
# STEP 1: 선형 회귀란 무엇인가?
# ============================================================

# 질문: "공부를 1시간 더 하면 시험 점수가 몇 점 오를까?"
# 답: 이런 질문에 답하는 것이 선형 회귀입니다!

# 선형 회귀 = 직선으로 데이터의 패턴을 찾는 방법
#
# 상상해보세요:
# - 공부 시간(x)과 시험 점수(y)의 관계를 점으로 찍으면
# - 점들 사이에 대충 직선이 보입니다
# - 이 직선을 수식으로 표현하면 미래를 예측할 수 있습니다!

# 직선의 수식: y = wx + b
# - x: 입력값 (예: 공부 시간)
# - y: 출력값 (예: 시험 점수)
# - w: 기울기 (공부 시간이 1시간 늘면 점수가 w만큼 오름)
# - b: 절편 (공부를 0시간 해도 받을 수 있는 기본 점수)

# 실생활 예시:
# 1. 공부 시간 → 시험 점수
# 2. 집 면적 → 집 가격
# 3. 광고비 → 매출
# 4. 온도 → 아이스크림 판매량

print("=" * 60)
print("STEP 1: 선형 회귀의 개념")
print("=" * 60)
print("\n[개념] 직선으로 데이터의 패턴을 찾기")
print("공식: y = wx + b")
print("  - w(기울기): x가 1 증가할 때 y가 얼마나 증가하는가?")
print("  - b(절편): x가 0일 때 y의 값")
print()

# ============================================================
# STEP 2: 왜 오차를 제곱할까?
# ============================================================

print("=" * 60)
print("STEP 2: 오차(에러) 측정하기")
print("=" * 60)

# 문제: 직선이 데이터를 얼마나 잘 설명하는지 어떻게 알까?
# 답: 오차를 측정합니다!

# 오차 = 실제값 - 예측값
#
# 예시:
# - 실제 점수: 80점
# - 예측 점수: 75점
# - 오차: 80 - 75 = 5점

# 근데 문제가 있어요!
# - 어떤 예측은 +5 틀림
# - 어떤 예측은 -5 틀림
# - 평균 내면: (+5) + (-5) = 0 (오차가 없는 것처럼 보임!)

# 해결책: 오차를 제곱!
# - (+5)² = 25
# - (-5)² = 25
# - 평균: (25 + 25) / 2 = 25 (오차가 명확히 보임!)

# 이것이 MSE (Mean Squared Error) = 평균 제곱 오차
# MSE = (모든 오차의 제곱의 합) / 데이터 개수

print("\n[문제] 오차가 +와 -로 상쇄되면 정확도를 알 수 없음")
print("[해결] 오차를 제곱하면 모두 양수가 됨")
print("\nMSE (평균 제곱 오차) = 예측이 얼마나 틀렸는지 측정")
print("MSE가 작을수록 = 예측이 정확함")
print()

# ============================================================
# STEP 3: 최적의 직선 찾기 (최소제곱법)
# ============================================================

print("=" * 60)
print("STEP 3: 최적의 직선 찾기")
print("=" * 60)

# 목표: MSE가 가장 작은 w와 b를 찾기
#
# 방법 1: 최소제곱법 (수학 공식으로 한번에 계산)
# - w = (x와 y의 공분산) / (x의 분산)
# - b = y평균 - w × x평균
#
# 어려워 보이지만 numpy로 쉽게 계산 가능!

import numpy as np
from sklearn.linear_model import LinearRegression
from sklearn.metrics import r2_score
import matplotlib.pyplot as plt

# 한글 폰트 설정 (그래프에서 한글 깨짐 방지)
plt.rcParams['font.family'] = 'Malgun Gothic'
plt.rcParams['axes.unicode_minus'] = False

# 데이터 준비 (공부 시간과 시험 점수)
print("\n[예제] 공부 시간과 시험 점수의 관계")
print("-" * 60)

공부시간 = np.array([1, 2, 3, 4, 5])  # 시간
시험점수 = np.array([2, 4, 5, 4, 5])  # 점수 (10점 만점)

print("데이터:")
for i in range(len(공부시간)):
    print(f"  {공부시간[i]}시간 공부 → {시험점수[i]}점")

# 평균 계산
공부시간_평균 = np.mean(공부시간)
시험점수_평균 = np.mean(시험점수)

print(f"\n평균:")
print(f"  공부시간 평균: {공부시간_평균}시간")
print(f"  시험점수 평균: {시험점수_평균}점")

# 최소제곱법으로 w와 b 계산
# (복잡해 보이지만 그냥 공식입니다!)
분자 = np.sum((공부시간 - 공부시간_평균) * (시험점수 - 시험점수_평균))
분모 = np.sum((공부시간 - 공부시간_평균) ** 2)

w = 분자 / 분모  # 기울기
b = 시험점수_평균 - w * 공부시간_평균  # 절편

print(f"\n[계산 결과]")
print(f"  기울기 (w): {w:.4f}")
print(f"  의미: 1시간 더 공부하면 {w:.2f}점 오름")
print(f"\n  절편 (b): {b:.4f}")
print(f"  의미: 공부를 안해도 기본 {b:.2f}점")
print(f"\n  예측 공식: 점수 = {w:.2f} × 공부시간 + {b:.2f}")
print()

# ============================================================
# STEP 4: scikit-learn으로 쉽게 하기
# ============================================================

print("=" * 60)
print("STEP 4: scikit-learn 라이브러리 사용하기")
print("=" * 60)

# 위에서 한 계산을 라이브러리가 자동으로 해줍니다!
# 3줄이면 끝!

# 데이터를 2차원 배열로 변환 (scikit-learn 규칙)
X = 공부시간.reshape(-1, 1)  # [[1], [2], [3], [4], [5]]
y = 시험점수                  # [2, 4, 5, 4, 5]

# 1줄: 모델 만들기
model = LinearRegression()

# 2줄: 학습하기 (w와 b를 자동으로 찾아줌)
model.fit(X, y)

# 3줄: 결과 확인
print(f"\n[scikit-learn 결과]")
print(f"  기울기: {model.coef_[0]:.4f}")
print(f"  절편: {model.intercept_:.4f}")
print(f"  (위에서 직접 계산한 것과 같습니다!)")

# 예측해보기
예측점수 = model.predict(X)
print(f"\n예측값: {예측점수}")
print()

# ============================================================
# STEP 5: 시각화로 이해하기
# ============================================================

print("=" * 60)
print("STEP 5: 그래프로 확인하기")
print("=" * 60)
print("\n그래프 창이 열립니다. 창을 닫으면 다음 단계로 진행됩니다.")

plt.figure(figsize=(10, 6))

# 1. 실제 데이터 (파란 점)
plt.scatter(X, y, color='blue', s=100, label='실제 데이터', zorder=3)

# 2. 예측 직선 (빨간 선)
plt.plot(X, 예측점수, color='red', linewidth=2, label='예측 직선', zorder=2)

# 3. 오차 표시 (초록 점선)
for i in range(len(X)):
    plt.plot([X[i], X[i]], [y[i], 예측점수[i]],
             'g--', alpha=0.5, zorder=1)

plt.xlabel('공부 시간 (시간)', fontsize=12)
plt.ylabel('시험 점수 (점)', fontsize=12)
plt.title('선형 회귀: 공부 시간 vs 시험 점수', fontsize=14, fontweight='bold')
plt.legend(fontsize=10)
plt.grid(True, alpha=0.3)
plt.tight_layout()
plt.show()

# ============================================================
# STEP 6: 실전 예제 - 광고비와 매출 예측
# ============================================================

print("\n" + "=" * 60)
print("STEP 6: 실전 예제 - 광고비로 매출 예측하기")
print("=" * 60)

# 상황: 당신은 온라인 쇼핑몰 운영자입니다.
# 질문: "광고비를 15백만원 쓰면 매출이 얼마나 나올까?"

# 과거 데이터 (광고비 → 매출)
광고비 = np.array([1, 2, 3, 4, 5, 6, 7, 8, 9, 10]).reshape(-1, 1)  # 백만원
매출 = np.array([3, 5, 6, 8, 11, 13, 14, 16, 17, 20])  # 천만원

print("\n[과거 데이터]")
print("광고비(백만원) → 매출(천만원)")
for i in range(len(광고비)):
    print(f"  {광고비[i][0]:2.0f}백만원 → {매출[i]:2.0f}천만원")

# 모델 학습
model_광고 = LinearRegression()
model_광고.fit(광고비, 매출)

print(f"\n[학습 결과]")
print(f"  기울기: {model_광고.coef_[0]:.4f}")
print(f"  의미: 광고비 1백만원당 매출 {model_광고.coef_[0]:.2f}천만원 증가")
print(f"\n  절편: {model_광고.intercept_:.4f}")
print(f"  의미: 광고 안해도 기본 매출 {model_광고.intercept_:.2f}천만원")

# 예측하기!
새로운_광고비 = np.array([[15]])  # 15백만원
예상_매출 = model_광고.predict(새로운_광고비)

print(f"\n[예측]")
print(f"  광고비 15백만원 투자 시")
print(f"  → 예상 매출: {예상_매출[0]:.1f}천만원")

# 모델의 정확도 측정 (R² Score)
매출_예측 = model_광고.predict(광고비)
r2 = r2_score(매출, 매출_예측)

print(f"\n[정확도]")
print(f"  R² Score: {r2:.4f}")
print(f"  의미: 모델이 데이터의 {r2*100:.1f}%를 설명")
if r2 > 0.9:
    print(f"  평가: 매우 정확한 모델! ✓")
elif r2 > 0.7:
    print(f"  평가: 괜찮은 모델")
else:
    print(f"  평가: 개선이 필요한 모델")
print()

# ============================================================
# STEP 7: 결과를 비즈니스 언어로 번역하기
# ============================================================

print("=" * 60)
print("STEP 7: 머신러닝 → 비즈니스 언어 번역")
print("=" * 60)

# 중요! 숫자만 말하면 아무도 모릅니다!
# 머신러닝 지표 → 액션 가능한 메시지로 번역

print("\n❌ 나쁜 예:")
print("   'R²가 0.81이고 MSE가 23입니다.'")
print("   → 듣는 사람: '그래서 뭘 해야 하는데?'")

print("\n✓ 좋은 예 1 (의사결정권자):")
print("   '광고비를 10% 늘리면 매출이 약 15% 증가할 것으로 예상됩니다.")
print("    현재 수익률을 고려하면 광고비 증액이 이익에 도움이 됩니다.'")

print("\n✓ 좋은 예 2 (뷔페 운영자):")
print("   '다음주 화요일은 평소보다 손님이 15~20% 많을 것으로 예상됩니다.")
print("    재료를 기준 대비 10% 추가 발주하시면 안전합니다.'")

print("\n✓ 좋은 예 3 (조리 담당):")
print("   '피크 시간대가 12:10~12:40에 집중될 확률이 높습니다.")
print("    이 시간 전에 주력 메뉴 준비를 끝내시면 좋을 것 같습니다.'")

print("\n[핵심 원칙]")
print("  1. 기술 용어(R², MSE) 대신 → 퍼센트, 구체적 수치")
print("  2. 모델 성능 대신 → 무엇을 해야 하는지")
print("  3. 과거 분석 대신 → 미래 행동 가이드")
print()

# ============================================================
# 요약 및 다음 단계
# ============================================================

print("=" * 60)
print("🎉 축하합니다! 선형 회귀를 마스터했습니다!")
print("=" * 60)

print("\n[오늘 배운 내용]")
print("  ✓ 선형 회귀 = 직선으로 패턴 찾기")
print("  ✓ MSE = 오차를 측정하는 방법")
print("  ✓ 최소제곱법 = 최적의 직선 찾기")
print("  ✓ scikit-learn = 3줄로 끝내기")
print("  ✓ 실전 활용 = 비즈니스 언어로 번역")

print("\n[핵심 코드 3줄]")
print("  model = LinearRegression()  # 모델 만들기")
print("  model.fit(X, y)             # 학습하기")
print("  model.predict(새로운데이터) # 예측하기")

print("\n[다음 단계]")
print("  → 02_경사하강법.py: 컴퓨터가 어떻게 최적의 직선을 찾는지")
print("  → 03_다중선형회귀.py: 여러 요인을 동시에 고려하기")

print("\n[연습 문제]")
print("  1. 당신의 데이터로 선형 회귀 모델 만들어보기")
print("  2. R² Score가 0.5 미만이면? → 다른 모델 고려")
print("  3. 예측 결과를 1분 안에 설명할 수 있나요?")

print("\n" + "=" * 60)
print("Happy Learning! 🚀")
print("=" * 60)
